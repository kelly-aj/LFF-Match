<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>jsPsych v7 — Working Starter</title>

  <!-- jsPsych core (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css">
  <script src="https://unpkg.com/jspsych@7.3.4"></script>

  <!-- Plugins (CDN) -->
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.2.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@1.1.3"></script>

  <!-- Stop favicon 404 noise -->
  <link rel="icon" href="data:,">

  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    body { background: #f7f7f9; }
  </style>
</head>
<body>
  <script>
    // --- Error banner so a truly blank screen still shows what's wrong ---
    window.addEventListener('error', (e) => {
      const pre = document.createElement('pre');
      pre.textContent = 'Error: ' + e.message;
      pre.style.color = 'white';
      pre.style.background = '#c0392b';
      pre.style.padding = '12px';
      pre.style.margin = 0;
      pre.style.font = '14px/1.4 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
      document.body.prepend(pre);
      console.error('Global error:', e.message, e.filename, e.lineno, e.colno, e.error);
    });

    // --- (1) Initialize jsPsych FIRST (before any reference to jsPsych) ---
    const jsPsych = initJsPsych({
      on_finish: () => {
        console.log('Experiment finished.');
      }
    });

    // --- (2) Helpers that might reference jsPsych come AFTER init ---
    // Example shuffle that relies on jsPsych.randomization
    function shuffle(array) {
      return jsPsych.randomization.shuffle(array);
    }

    // --- (3) Define your trials ---
    // Minimal "hello" trial — replace with your real trials later
    const hello = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <div style="font-size: 28px;">
          Hello, jsPsych v7 is running!<br><br>
          <em>Press any key to continue.</em>
        </div>
      `
    };

    // Example of using the shuffle helper safely
    const items = ['A', 'B', 'C', 'D'];
    const shuffled = shuffle(items);

    const showShuffle = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `<div style="font-size: 22px;">Shuffled: ${shuffled.join(' • ')}</div>`,
      choices: ['Continue']
    };

    const rating = {
      type: jsPsychHtmlSliderResponse,
      stimulus: '<div style="font-size:20px;">How confident are you this works now?</div>',
      labels: ['Not at all', 'Somewhat', 'Very'],
      require_movement: true
    };

    const instructions = {
      type: jsPsychInstructions,
      pages: [
        '<div style="font-size:22px;">Welcome to the task.<br><br>Use buttons or keys as prompted.</div>',
        '<div style="font-size:22px;">Click "Next" to begin.</div>'
      ],
      show_clickable_nav: true
    };

    // --- (4) Timeline must not be empty ---
    const timeline = [instructions, hello, showShuffle, rating];

    // --- (5) Start the experiment ---
    jsPsych.run(timeline);
  </script>
</body>
</html>
